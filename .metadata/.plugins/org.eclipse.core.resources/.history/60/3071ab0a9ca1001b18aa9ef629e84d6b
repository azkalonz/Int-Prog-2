(()=>{
	const timeInBtn = $("#time-in-btn");
	const timeOutBtn = $("#time-out-btn");
	const getUser = ()=>JSON.parse(localStorage['user']);
	const updateDateToday = ()=>{
		$("#date-today").text(moment().format("LLL"));
	}
	const setLatestRecord = ()=>{
		const records = getUser().records.sort((a,b)=>new Date(b.date_in) - new Date(a.date_in));
		const dateNow = moment().format("LL");
		const lastRecordDate = moment(records[0].date_in).format("LL");
		const alreadyTimedOut = records[0].date_out === "";
		
		if(dateNow === lastRecordDate && !alreadyTimedOut){
			alert()
		}
		
	}
	window.timeTicker = setInterval(()=>{
		updateDateToday();
	},60000);
	const printDTRRecords = ()=>{
		getUser().records.map(record=>{
			const date = moment(record.date_in).format("LL");
			const timeIn = moment(record.date_in).format("hh:mm A");
			const timeOut = moment(record.date_out).format("hh:mm A");
			const timeSpan = timeIn+" - "+(timeOut == "Invalid date"? "<i>pending</i>":timeOut);
			let duration = moment.duration(moment(record.date_out).diff(moment(record.date_in))).asHours();
			if(isNaN(duration)){
				duration = "To be defined";
			} else {
				duration = `${duration.toFixed(2)} hours`;
			}
			
			$("#dtr-body").append(`
					<tr>
						<td>${date}</td>
						<td>${timeSpan}</td>
						<td>${duration}</td>
					</tr>
			
			`);
		});
	}
	const init = ()=>{
		updateDateToday();
		printDTRRecords();
		setLatestRecord();
		$("[name=employeeID]").val(getUser().employeeID);
	}
	
	init();
})();